// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  seed        = "ts-node prisma/seed.ts"
  binaryTargets = ["native", "linux-arm64-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL") 
}

// L'utilisateur 
model User {
  id String @id
  name String
  email String
  emailVerified Boolean
  image String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  loginAttempts Int @default(0)

  role UserRole?

  sessions Session[]
  accounts Account[]
  initiatives Initiative[]

  @@unique([email])
  @@map("user")
}

// Retrouver l'utilisateur quand il refresh sans se reconnecter
// Maintenir l’état “connecté”
// gérer expiration / logout
model Session {
  id String @id
  expiresAt DateTime
  token String
  createdAt DateTime
  updatedAt DateTime
  ipAddress String?
  userAgent String?
  userId String
  user User @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@unique([token])
  @@map("session")
}

model Initiative {
  id Int @id @default(autoincrement())
  name String
  description String
  initiativeType InitiativeType[]
  narrative String?
  associationName String?
  email String? 
  webSite String?                     
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  contributorId String
  contributor User @relation(fields: [contributorId], references: [id], onDelete: Cascade, onUpdate: Cascade) 

  initiativeLocation InitiativeLocation @relation(fields: [initiativeLocationId], references: [id])
  initiativeLocationId Int @unique

  @@map("initiative")
}

//Moyen d'authentification
model Account {
  id String @id
  accountId String
  providerId String
  userId String
  user User @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  accesToken String?
  refreshToken String?
  idToken String?
  accessTokenExpiresAt DateTime?
  refreshTokenExpriresAt DateTime?
  password String?
  scope String?
  createdAt DateTime
  updatedAt DateTime

  @@map("account")
}

//Vérifier des choses
// Reset password
// Vérifier l'email
model Verification {
  id String @id
  identifier String
  value String
  expiresAt DateTime?
  createdAt DateTime?

  @@map("verification")
}


model InitiativeLocation {
  id Int @id @default(autoincrement())
  street String
  postcode String
  city String
  latitude Float
  longitude Float

  initiativeId Initiative?

  @@map("initiativeLocation")
}

enum InitiativeType {
  ClimateAgricultureEnergy
  UrbanismAndTechnology
  SolidarityAndCommunities
  CultureAndTransmission
  EducationAndAwareness
  SocialAndSolidarityEconomy
}

enum UserRole {
  CONTRIBUTOR
}
